<?xml version="1.0" encoding="UTF-8" standalone="no" ?>

<!-- Constructing XML-like REST metadata input file
     File : config.rml
     First concept author J. Galan (26-Apr-2015)
     Second concept author G. Luzon (March-2017)
     Adapted for IAXOD0 by E. Ruiz-ChÃ³liz (April-2017) -->

<!-- Any commented text will just not end up in the configBuffer inside TRestMetadata 
     We can comment out pieces of configuration using XML commenting style.
     
     By default REST units are mm, keV and degrees -->

<TRestManager name="RESTManagerSim" title="Template manager to process a simulation generated by restG4.">

<!-- Global variables -->

<globals>
    <variable name="EXPERIMENT" value="IAXOD0" overwrite="false" />
    <variable name="VERSION" value="2.0" overwrite="false" />

    <variable name="IAXOD0_PATH" value="${HOME}/RPE_IAXO_REST_v2.2.10/IAXO_AGET-REST" overwrite="false" />
    <variable name="IAXOD0_DATAPATH" value="${HOME}/RPE_IAXO_REST_v2.2.10/data/IAXOD0" overwrite="false" />

    <variable name="IAXOD0_G4PATH" value="${IAXOD0_PATH}/G4sims" overwrite="false" />
    <variable name="IAXOD0_GEOPATH" value="${IAXOD0_G4PATH}/geometry" overwrite="false" />

    <variable name="IAXOD0_GEODIR" value="Argon_AGET_closer" overwrite="false" />  
    <variable name="DIR_DATA" value="TrackAnalysis" overwrite="false" />

    <variable name="IAXOD0_GAS" value="Argon-Isobutane 2Pct 10-10E3V/cm" overwrite="false" />

    <variable name="READOUT_ROOTFILE" value="IAXOD0_Readout.root" overwrite="false" /> 
    <variable name="READOUT_NAME" value="IAXOD0_Readout_final" overwrite="false" /> 

<!-- Global parameters -->
    <parameter name="mainDataPath" value="${IAXOD0_DATAPATH}/${IAXOD0_GEODIR}/${DIR_DATA}" />
    <parameter name="gasDataPath" value="${REST_PATH}/inputData/gasFiles/" />
    <parameter name="REST_INPUTDATA" value="${REST_PATH}/inputData/" />
    <parameter name="verboseLevel" value="warning" /> %options are : silent, warning, info, debug
    
    <searchPath value="${REST_INPUTDATA}/definitions/"/>
    <searchPath value="${REST_INPUTDATA}/gasFiles/"/>

</globals>

<!-- Run information -->

<TRestRun name="Electronics Background Model" title="Simulations ${EXPERIMENT}. Version ${VERSION}.">
    <parameter name="experiment" value="${EXPERIMENT}"/>
    <parameter name="runType" value="TrackAnalysis"/>
    <parameter name="readOnly" value="false" />
    <parameter name="runNumber" value="same"/>
    <parameter name="runTag" value="same"/>
    <parameter name="runDescription" value="same"/>
    <parameter name="user" value="${USER}"/>
    <parameter name="verboseLevel" value="3"/>
    <parameter name="overwrite" value="off" />
    <parameter name="outputFile" value="Run_[fRunType]_[fRunTag]_[fRunNumber]_Version_[VERSION].root" />

    <TRestGas name="Argon-Isobutane 2Pct 10-10E3Vcm" pressure="0.5" file="${REST_PATH}/inputData/definitions/gases.rml"/>
    <addMetadata type="TRestReadout" name="IAXOD0_Readout_final" file="${IAXOD0_G4PATH}/restProcesses/readouts.root"/> 

    <!-- Setting source config files -->
    <parameter name="gasFile" value="${REST_PATH}/inputData/definitions/gases.rml" />
    <parameter name="readoutFile" value="${IAXOD0_G4PATH}/restProcesses/readouts.root" />
    <parameter name="processesFile" value="${IAXOD0_G4PATH}/restProcesses/G4processes.rml" />
    <parameter name="tasksFile" value="${IAXOD0_G4PATH}/restPlots/plots.rml" /> 

</TRestRun>

<!-- Process manager -->

<TRestProcessRunner name="restSimAnalysis" title="restSimAnalysis">

    <parameter name="inputFile" value="${REST_INPUTFILE}"/>

    <parameter name="inputAnalysis" value="off"/>
    <parameter name="inputEvent" value="on"/>
    <parameter name="outputEvent" value="on"/>

    <parameter name="firstEntry" value="0" />
    <parameter name="lastEntry" value="0" />
    <parameter name="eventsToProcess" value="" />
    <parameter name="pureAnalysisOutput" value="OFF" />


    <!-- Adding processes -->

        <!-- Geant4 Analysis -->
        <addProcess type="TRestGeant4AnalysisProcess" name="g4Ana" value="ON" file="G4processes.rml" />

        <!-- Hits Analysis -->
        <addProcess type="TRestG4toHitsProcess" name="G4ToHits" value="ON" file="G4processes.rml" />
        <addProcess type="TRestElectronDiffusionProcess" name="IAXOD0_Ar2Iso_1.4bar" value="ON" file="G4processes.rml" />
        <addProcess type="TRestHitsReductionProcess" name="hitsReduction-IAXOD0"  value="ON" file="G4processes.rml" />
        <addProcess type="TRestHitsAnalysisProcess" name="hitsAna" value="ON" file="G4processes.rml" />

        <!-- Tracks Analysis -->
        <addProcess type="TRestHitsToTrackProcess" name="hitsToTrack" value="ON" file="G4processes.rml" />  
        <addProcess type="TRestTrackReductionProcess" name="trackReduction-IAXOD0"  value="OFF" file="G4processes.rml" />
        <addProcess type="TRestTrackPathMinimizationProcess" name="trackPathMinimization-Template" value="OFF" file="G4processes.rml" />
        <addProcess type="TRestTrackReconnectionProcess" name="trackReconnection-Template" value="OFF" file="G4processes.rml" />
        <addProcess type="TRestTrackAnalysisProcess" name="tckAna" value="ON" file="G4processes.rml" />

</TRestProcessRunner>

    <!-- Now we need to define in the manager the tasks we will perform.
         If task processEvents is not enabled processes will not be launched --> 
    <addTask type="processEvents" value="ON" />

    <!-- If analysisPlot is before the processEvents task it will take as input file the input for TRestRun.
         If it is after processEvents it will take the output of TRestRun. -->
    <addTask type="analysisPlot" name="Template" value="OFF" />



 <globals>
    <parameter name="outputLevel" value="internalvar" /> %options are : nooutput(0), observable(1), internalvar(2), fulloutput(3)
    <parameter name="verboseLevel" value="1" /> %options are : silent(0), essential(1), info(2), debug(3), extreme(4)
    <searchPath value="$ENV{REST_INPUTDATA}/definitions/"/>
</globals>

</TRestManager>